# Test the add_dependencies function
# That touches the following cases:
# e3sm_diags: enso_diags, qbo (depend_on_ts)
# e3sm_diags: streamflow
# e3sm_diags: tropical_subseasonal
# global_time_series: use_atm, use_lnd (custom, original_8_no_ocn, original_8)
# ilamb: with or without land_only (base case, land_only)

[default]
case = "v3.LR.historical_0051"
constraint = ""
dry_run = "False"
environment_commands = ""
input = /lcrc/group/e3sm2/ac.wlin/E3SMv3/v3.LR.historical_0051
input_subdir = archive/atm/hist
mapping_file = "map_ne30pg2_to_cmip6_180x360_aave.20200201.nc"
output = "/lcrc/group/e3sm/ac.forsyth2/zppy_min_case_add_dependencies_output/unique_id/v3.LR.historical_0051"
partition = "debug"
qos = "regular"
# ts is in 5 year increments
ts_num_years = 5
www = "/lcrc/group/e3sm/public_html/diagnostic_output/ac.forsyth2/zppy_min_case_add_dependencies_www/unique_id"
# We want to produce diagnostics for 10 years.
years = "1985:1995:10",

[ts]
active = True
e3sm_to_cmip_environment_commands = ""
walltime = "00:50:00"
# ts is in 5 year increments
years = "1985:1995:5"

  [[ atm_monthly_180x360_aave ]]
  # for e3sm_diags (depend_on_ts), ilamb
  frequency = "monthly"
  input_files = "eam.h0"
  input_subdir = "archive/atm/hist"
  ts_fmt = "cmip"
  vars = "FSNTOA,FLUT,FSNT,FLNT,FSNS,FLNS,SHFLX,QFLX,TAUX,TAUY,PRECC,PRECL,PRECSC,PRECSL,TS,TREFHT,CLDTOT,CLDHGH,CLDMED,CLDLOW,U,ICEFRAC,LANDFRAC,OCNFRAC,PS,CLDICE,CLDLIQ,T,AODDUST"

  [[ land_monthly ]]
  # for ilamb
  extra_vars = "landfrac"
  frequency = "monthly"
  input_files = "elm.h0"
  input_subdir = "archive/lnd/hist"
  mapping_file = "map_r05_to_cmip6_180x360_aave.20231110.nc"
  ts_fmt = "cmip"
  vars = "FSH,RH2M,LAISHA,LAISUN,QINTR,QOVER,QRUNOFF,QSOIL,QVEGE,QVEGT,SOILICE,SOILLIQ,SOILWATER_10CM,TSA,TSOI,H2OSNO,TOTLITC,CWDC,SOIL1C,SOIL2C,SOIL3C,SOIL4C,WOOD_HARVESTC,TOTVEGC,NBP,GPP,AR,HR"

  [[ rof_monthly ]]
  # for e3sm_diags (streamflow)
  extra_vars = 'areatotal2'
  frequency = "monthly"
  input_files = "mosart.h0"
  input_subdir = "archive/rof/hist"
  mapping_file = ""
  vars = "RIVER_DISCHARGE_OVER_LAND_LIQ"

  [[ atm_daily_180x360_aave ]]
  # for e3sm_diags (tropical_subseasonal)
  frequency = "daily"
  input_files = "eam.h1"
  vars = "PRECT"

  [[ atm_monthly_glb ]]
  # for global_time_series (custom)
  frequency = "monthly"
  input_files = "eam.h0"
  input_subdir = "archive/atm/hist"
  mapping_file = "glb"
  vars = "TREFHT,AODDUST"

  [[ lnd_monthly_glb ]]
  # for global_time_series (custom)
  frequency = "monthly"
  input_files = "elm.h0"
  input_subdir = "archive/lnd/hist"
  mapping_file = "glb"
  vars = "FSH,RH2M,LAISHA,LAISUN,QINTR,QOVER,QRUNOFF,QSOIL,QVEGE,QVEGT,SOILWATER_10CM,TSA,H2OSNO,TOTLITC,CWDC,SOIL1C,SOIL2C,SOIL3C,SOIL4C,WOOD_HARVESTC,TOTVEGC,NBP,GPP,AR,HR"

[e3sm_diags]
active = True
environment_commands = "source /home/ac.forsyth2/miniconda3/etc/profile.d/conda.sh; conda activate e3sm_diags_20241015"
grid = '180x360_aave'
multiprocessing = True
num_workers = 8
partition = "compute"
qos = "regular"
short_name = "v3.LR.historical_0051"
walltime = "5:00:00"

  [[ atm_monthly_180x360_aave ]]
  ref_final_yr = 1995
  ref_start_yr = 1985
  sets = "enso_diags","qbo","streamflow","tropical_subseasonal",
  # streamflow_obs_ts is determined automatically

[global_time_series]
active = True
experiment_name = "v3.LR.historical_0051"
figstr = "v3.LR.historical_0051"
plots_original=""
plots_atm = "TREFHT,AODDUST"
plots_lnd = "FSH,RH2M,LAISHA,LAISUN,QINTR,QOVER,QRUNOFF,QSOIL,QVEGE,QVEGT,SOILWATER_10CM,TSA,H2OSNO,TOTLITC,CWDC,SOIL1C,SOIL2C,SOIL3C,SOIL4C,WOOD_HARVESTC,TOTVEGC,NBP,GPP,AR,HR"
walltime = "00:30:00"

[ilamb]
active = True
nodes = 8
partition = "compute"
short_name = "v3.LR.historical_0051"
ts_num_years = 30
walltime = "2:00:00"
