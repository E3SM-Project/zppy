

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Getting started &mdash; zppy  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing to this documentation" href="contributing.html" />
    <link rel="prev" title="Zppy documentation" href="index.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> zppy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Zppy documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-file">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running">Running</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to this documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">zppy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Install zppy by cloning its repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">E3SM</span><span class="o">/</span><span class="n">code</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">E3SM</span><span class="o">-</span><span class="n">Project</span><span class="o">/</span><span class="n">zppy</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>All the necessary dependencies for running zppy are available
in the E3SM Unified conda environment. Activate it using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># for bash shell</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="n">activate_path</span><span class="o">&gt;/</span><span class="n">load_latest_e3sm_unified</span><span class="o">.</span><span class="n">sh</span>
<span class="c1"># or for csh shell</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="n">activate_path</span><span class="o">&gt;/</span><span class="n">load_latest_e3sm_unified</span><span class="o">.</span><span class="n">csh</span>
</pre></div>
</div>
<p>where &lt;activate_path&gt; is machine dependent:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Machine</p></th>
<th class="head"><p>&lt;activate_path&gt;</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Anvil/chrysalis (ANL)</p></td>
<td><p>/lcrc/soft/climate/e3sm-unified</p></td>
</tr>
<tr class="row-odd"><td><p>Compy (PNNL)</p></td>
<td><p>/share/apps/E3SM/conda_envs/</p></td>
</tr>
<tr class="row-even"><td><p>Cori (NERSC)</p></td>
<td><p>/global/cfs/cdirs/e3sm/software/anaconda_envs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-file">
<h2>Configuration file<a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h2>
<p>As a first example, let’s say we want to post-process 100 years
of an existing simulation. In particular, we’d like to generate
the following:</p>
<ul class="simple">
<li><p>Regridded atmosphere climatologies every 20 and 50 years</p></li>
<li><p>Regridded atmosphere monthly time series files in 10 year chunks</p></li>
<li><p>E3SM Diags every 20 and 50 years</p></li>
<li><p>MPAS-Analysis</p></li>
</ul>
<p>First, create a configuration file in your favorite editor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">E3SM</span><span class="o">/</span><span class="n">script</span>
<span class="n">gvim</span> <span class="n">post</span><span class="o">.</span><span class="n">mysimulation</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>Copy and paste the following:</p>
<div class="highlight-cfg notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">input</span> <span class="o">=</span> <span class="s">/lcrc/group/e3sm/ac.golaz/E3SM_simulations/20210305.v2beta3.piControl.ne30pg2_EC30to60E2r2.chrysalis</span>
<span class="na">output</span> <span class="o">=</span> <span class="s">/lcrc/group/e3sm/ac.golaz/E3SM_simulations/20210305.v2beta3.piControl.ne30pg2_EC30to60E2r2.chrysalis</span>
<span class="na">case</span> <span class="o">=</span> <span class="s">20210305.v2beta3.piControl.ne30pg2_EC30to60E2r2.chrysalis</span>
<span class="na">www</span> <span class="o">=</span> <span class="s">/lcrc/group/e3sm/public_html/diagnostic_output/ac.golaz/E3SM/v2/beta</span>
<span class="na">partition</span> <span class="o">=</span> <span class="s">compute</span>

<span class="k">[climo]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">years</span> <span class="o">=</span> <span class="s">&quot;1:100:20&quot;, &quot;1:100:50&quot;,</span>

  <span class="k">[[ atm_monthly_180x360_aave ]]</span>
  <span class="na">mapping_file</span> <span class="o">=</span> <span class="s">/home/ac.zender/data/maps/map_ne30pg2_to_cmip6_180x360_aave.20200201.nc</span>

<span class="k">[ts]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">years</span> <span class="o">=</span> <span class="s">&quot;1:100:10&quot;,</span>

  <span class="k">[[ atm_monthly_180x360_aave ]]</span>
  <span class="na">input_subdir</span> <span class="o">=</span> <span class="s">&quot;archive/atm/hist&quot;</span>
<span class="s">  input_files = &quot;eam.h0&quot;</span>
<span class="s">  mapping_file = /home/ac.zender/data/maps/map_ne30pg2_to_cmip6_180x360_aave.20200201.nc</span>
<span class="s">  vars = &quot;FSNTOA,FLUT,FSNT,FLNT,FSNS,FLNS,SHFLX,QFLX,TAUX,TAUY,PRECC,PRECL,PRECSC,PRECSL,TS,TREFHT,CLDTOT,CLDHGH,CLDMED,CLDLOW&quot;</span>

  <span class="k">[[ atm_monthly_glb ]]</span>
  <span class="na">input_subdir</span> <span class="o">=</span> <span class="s">&quot;archive/atm/hist&quot;</span>
<span class="s">  input_files = &quot;eam.h0&quot;</span>
<span class="s">  mapping_file = &quot;glb&quot;</span>
<span class="s">  vars = &quot;FSNTOA,FLUT,FSNT,FLNT,FSNS,FLNS,SHFLX,QFLX,TAUX,TAUY,PRECC,PRECL,PRECSC,PRECSL,TS,TREFHT,CLDTOT,CLDHGH,CLDMED,CLDLOW&quot;</span>

<span class="k">[glb]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">False</span>

<span class="k">[e3sm_diags]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">years</span> <span class="o">=</span> <span class="s">&quot;1:100:20&quot;, &quot;1:100:50&quot;,</span>

  <span class="k">[[ atm_monthly_180x360_aave ]]</span>
  <span class="na">short_name</span> <span class="o">=</span> <span class="s">&#39;20210305.v2beta3.piControl&#39;</span>
<span class="s">  grid = &#39;180x360_aave&#39;</span>
<span class="s">  reference_data_path = &#39;/lcrc/soft/climate/e3sm_diags_data/obs_for_e3sm_diags/climatology&#39;</span>
<span class="s">  output_format_subplot = &quot;pdf&quot;,</span>

<span class="k">[e3sm_diags_vs_model]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">False</span>

<span class="k">[amwg]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">False</span>

<span class="k">[mpas_analysis]</span>
<span class="na">active</span> <span class="o">=</span> <span class="s">True</span>
<span class="na">walltime</span> <span class="o">=</span> <span class="s">&quot;24:00:00&quot;</span>
<span class="na">parallelTaskCount</span> <span class="o">=</span> <span class="s">6</span>
<span class="na">ts_years</span> <span class="o">=</span> <span class="s">&quot;1-50&quot;, &quot;1-100&quot;,</span>
<span class="na">enso_years</span> <span class="o">=</span> <span class="s">&quot;11-50&quot;, &quot;11-100&quot;,</span>
<span class="na">climo_years</span> <span class="o">=</span><span class="s">&quot;21-50&quot;, &quot;51-100&quot;,</span>
<span class="na">mesh</span> <span class="o">=</span> <span class="s">&quot;EC30to60E2r2&quot;</span>
</pre></div>
</td></tr></table></div>
<p>The configuration files consists of sections ([…]) and subsections ([[…]]). There is
a default section at the top ([default]) to define some common settings, followed
by a separate section for each available tasks. Within each task section, you can optionally
include an arbitrary number of subsections for multiple renditions of a given
tasks. The name of the subsections are arbitrary. They are used to name the batch
jobs and resolve dependencies.</p>
<p>Please note that the configuration file follows an inheritance model: [[ subsections ]] inherit settings
from their parent [section], which itself inherits settings from the [default] section.
Settings can be defined at arbitrary levels, with the lower level definition taking precedence:
[[ subsection ]] settings can overwrite [section] settings which can overwrite [default] settings.
Many settings also take on sensible default values if they are or set.</p>
<p>A detailed description of all available settings is provided in a next section
of the documentation. Here, we only
provide a brief overview:</p>
</div>
<div class="section" id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>To start the post-processing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">~/</span><span class="n">E3SM</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">zppy</span><span class="o">/</span><span class="n">post</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span> <span class="n">post</span><span class="o">.</span><span class="n">mysimulation</span><span class="o">.</span><span class="n">cfg</span>
</pre></div>
</div>
<p>Zppy will parse the configuration file, generate and submit all batch jobs.
Zppy can be invoked safely multiple times. Zppy will check status of previously
submitted tasks and will only submit new or previously incomplete tasks.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing to this documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Zppy documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, E3SM.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>